<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'/>
    <title>Mapbox GL JS Examples</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no'/>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.1.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.1.0/mapbox-gl.css' rel='stylesheet'/>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>
<body>

<div id='map'></div>
<script>

    var map = new mapboxgl.Map({
        'container': 'map',
        'zoom': 6,
        'center': [10, 10],
        'style': {
            'version': 8,
            'sources': {
                'carto-dark': {
                    'type': 'raster',
                    'tiles': [
                        "https://a.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",
                        "https://b.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",
                        "https://c.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",
                        "https://d.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png"
                    ]
                },
                'nasa_viirs_fire_alerts': {
                    'type': 'vector',
                    'tiles': [
                        "http://ec2-54-237-221-136.compute-1.amazonaws.com/nasa_viirs_fire_alerts/latest/default/{z}/{x}/{y}.pbf?start_date=2017-01-01&end_date=2017-12-31&high_confidence_only=False"
                    ]
                }

            },
            'layers': [{
                'id': 'carto-dark-layer',
                'type': 'raster',
                'source': 'carto-dark',
                'minzoom': 0,
                'maxzoom': 22
            }, {
                'id': 'viirs-points-agg',
                'type': 'circle',
                'source': 'nasa_viirs_fire_alerts',
                // ST_AsMVT() uses 'default' as layer name
                'source-layer': 'default',
                'minzoom': 0,
                'maxzoom': 6,
                'paint': {
                    'circle-radius': {
                        'base': 0.5,
                        'stops': [[3, 0.75], [5, 1], [7, 1.5], [8, 1.75], [9, 2], [10, 2.5], [11, 3], [12, 4]]
                    },
                    'circle-color': [
                        'interpolate',
                        ['linear'],
                        ["to-number", ["get", "frp"]],
                        0,
                        '#FFDA07',
                        2,
                        '#FFCC00',
                        4,
                        '#F76000',
                        8,
                        '#FF0000',
                        16,
                        '#B51212',
                        32,
                        '#000000'
                    ]
                }
            },
                {
                    'id': 'viirs-points',
                    'type': 'circle',
                    'source': 'nasa_viirs_fire_alerts',
                    // ST_AsMVT() uses 'default' as layer name
                    'source-layer': 'default',
                    'minzoom': 6,
                    'maxzoom': 22,
                    'paint': {
                        'circle-radius': {
                            'base': 0.5,
                            'stops': [[3, 0.75], [5, 1], [7, 1.5], [8, 1.75], [9, 2], [10, 2.5], [11, 3], [12, 4]]
                        },
                        'circle-color': [
                            'interpolate',
                            ['linear'],
                            ["to-number", ["get", "frp"]],
                            0,
                            '#FFDA07',
                            2,
                            '#FFCC00',
                            4,
                            '#F76000',
                            8,
                            '#FF0000',
                            16,
                            '#B51212',
                            32,
                            '#000000'
                        ]
                    }
                }
            ]
        }
    });


    map.addControl(new mapboxgl.NavigationControl());
    // When a click event occurs on a feature in the states layer, open a popup at the
    // location of the click, with description HTML from its properties.
    map.on('click', 'viirs-points', function (e) {
        console.log(e.features)
        new mapboxgl.Popup()
            .setLngLat(e.lngLat)
            .setHTML("<strong>MODIS VIIRS Fire Alerts</strong>" +
                "<p>Latitude: " + e.features[0].properties.latitude + "</p>" +
                "<p>Longitude: " + e.features[0].properties.longitude + "</p>" +
                "<p>Acquisition Date: " + e.features[0].properties.acq_date + "</p>" +
                "<p>Acquisition Time: " + e.features[0].properties.acq_time + "</p>" +
                "<p>Confidence: " + e.features[0].properties.confidence + "</p>" +
                "<p>Brightness - TI4 (K): " + e.features[0].properties.bright_ti4 + "</p>" +
                "<p>Brightness - TI5 (K): " + e.features[0].properties.bright_ti5 + "</p>" +
                "<p>Fire Radiative Power (MW): " + e.features[0].properties.frp + "</p>")

            .addTo(map);
    });

    map.on('click', 'viirs-points-agg', function (e) {
        console.log(e.features)
        new mapboxgl.Popup()
            .setLngLat(e.lngLat)
            .setHTML("<strong>MODIS VIIRS Fire Alerts</strong>" +
                "<p>Alert Count: " + e.features[0].properties.count + "</p>" +
                "<p>Avg Brightness - TI4 (K): " + Math.round(e.features[0].properties.bright_ti4, 1) + "</p>" +
                "<p>Avg Brightness - TI5 (K): " + Math.round(e.features[0].properties.bright_ti5, 1) + "</p>" +
                "<p>Total Fire Radiative Power (MW): " + e.features[0].properties.frp + "</p>")

            .addTo(map);
    });

    // Change the cursor to a pointer when the mouse is over the states layer.
    map.on('mouseenter', 'viirs-points', function () {
        map.getCanvas().style.cursor = 'pointer';
    });

    // Change it back to a pointer when it leaves.
    map.on('mouseleave', 'viirs-points', function () {
        map.getCanvas().style.cursor = '';
    });

</script>

</body>
</html>
